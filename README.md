# JN5169-monitor
Bootloader JN5169 содержит уязвимость которая позволяет получить доуступ к прошивке микроконтроллера при установленной защите CRP_LEVEL=1. Подробнее здесь https://re-engr.ru/jn5169-fw-lock/

Бинарный файл `/wire/mon5169.bin` записывается во FLASH память. В программе реализован командный интерфейс. В качестве канала связи используется USART0.  
Скрипт `/wire/upload.py` записывает прошивку в свободную память и делает ее активной. 

## Загрузка

1. Запустить JN5169 с ***низким*** уровнем на контакте /BOOT (пин 22, DO1);
2. В скрипте `/wire/upload.py` указать корректный номер COM-порта (например port='COM5');
3. Выполнить скрипт `/wire/upload.py`. Сообщение ***Flashing completed*** указывает на успешное завершение. Ошибки смотреть [здесь](#errors_script);
4. Запустить JN5169 с ***высоким*** уровнем на контакте /BOOT (пин 22, DO1);

## Управление
Запустить TeraTerm (рекомендуется). Подключиться к COM-порту с параметрами `115200 8n1, no flow control`. Нажать клавишу Enter. Вы увидите приветствие:
```
Monitor for JN5169
Author: re-engr.ru (Jun  5 2022)
Press key to read:
 'f' - flash (512KB)
 'w' - firmware
 'b' - bootloader
 'r' - RAM
 'e' - EEPROM
 'u' - user data
 'o' - OTP
 'n' - NIB
Input cmd for:
 '.e' - erase EEPROM
 '.p' - erase PDM
 '.r' - recovery FW
 ```
Команды `f, w, b, r, e` для передачи данных используют протокол XMODEM-CRC.

### Команды чтения
* `'f' - flash (512KB)` - прочитать FLASH память по физическим адресам;
* `'w' - firmware` - прочитать прошивку устройства. Полученный файл имеет необходимый заголовок и может быть записан в другое устройство;
* `'b' - bootloader` - прочитать сегмент с прошивкой бутлоадера;
* `'r' - RAM` - прочитатать всю RAM;
* `'e' - EEPROM` - прочитать всю EEPROM;
* `'u' - user data` - прочитать данные из области User data;
* `'o' - OTP` - прочитать однократно программируемую область памяти;
* `'n' - NIB` - прочитать информацию о zigbee сети в которой находится устройство (PAN ID, Short Addr, MAC Coord, Key). Так же определяется версия SDK;

### Команды исполнения
* `'.e' - erase EEPROM` - физическая очистка памяти EEPROM (все 0x00);
* `'.p' - erase PDM` - все блоки памяти, со своим ID, помечаются как очищенные. Структура "файловой системы" сохраняется;
* `'.r' - recovery FW` - переключиться на прошивку устройства. Сектор памяти с монитором очищается.

## XMODEM
Выберите память для чтения. Например EEPROM. Нажмите 'e'. Сообщение говорит об ожидании приемника:
```
e Receiver waiting (XMODEM-CRC)...
```
В TeraTerm перейдите: `File > Transfer > XMODEM > Receive...` Укажите имя файла. В поле "Option" выбрать `CRC` и галочку `Binary`. Нажмитре "Save", начнется прием данных и сохранения их в файл. Сообщение об успешной передаче данных:
```
e Receiver waiting (XMODEM-CRC)... Done
```
Ошибки смотреть [здесь](#errors_monitor);

## Ошибки
<a name="errors_script"></a>
### Скрипт

<a name="errors_monitor"></a>
### Монитор

## История версий
